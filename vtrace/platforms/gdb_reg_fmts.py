# Used to decode target response to the 'g' packet ("info registers")
# (register name, register size)

# This appears to be the full set of registers. Depending on the environment, 
# the GDB server may only use a subset of these registers (e.g. usermode 
# debugging probably won't use the control registers). It seems like the 
# order sent by the server is the same as the order you receive when sending 
# the 'info registers all' command to a standalone GDB client.

from envi.const import *

# translation between gdb and vivisect architecture names
GDBARCH_LOOKUP = {
    'i386': 'i386',
    'amd64': 'i386',
}

ARCH_META = {
        'powerpc:vle':{
            'arch': 'ppc32',
            'gdbarch': 'ppc32',
            'bigend': ENDIAN_MSB,
            'psize': 4,
            'pcname': 'pc',
            'spname': 'r1',
        },

        'i386:x86-64': {
            'arch': 'amd64',
            'gdbarch': 'i386',
            'bigend': ENDIAN_LSB,
            'psize': 8,
            'pcname': 'rip',
            'spname': 'rsp',
        },

        'i386:x86-32': {
            'arch': 'i386',
            'gdbarch': 'i386',
            'bigend': ENDIAN_LSB,
            'psize': 4,
            'pcname': 'eip',
            'spname': 'esp',
        },
}


QEMU_PPC64_REG = [
        ('r0', 0x40, 0x0),
        ('r1', 0x40, 0x1),
        ('r2', 0x40, 0x2),
        ('r3', 0x40, 0x3),
        ('r4', 0x40, 0x4),
        ('r5', 0x40, 0x5),
        ('r6', 0x40, 0x6),
        ('r7', 0x40, 0x7),
        ('r8', 0x40, 0x8),
        ('r9', 0x40, 0x9),
        ('r10', 0x40, 0xa),
        ('r11', 0x40, 0xb),
        ('r12', 0x40, 0xc),
        ('r13', 0x40, 0xd),
        ('r14', 0x40, 0xe),
        ('r15', 0x40, 0xf),
        ('r16', 0x40, 0x10),
        ('r17', 0x40, 0x11),
        ('r18', 0x40, 0x12),
        ('r19', 0x40, 0x13),
        ('r20', 0x40, 0x14),
        ('r21', 0x40, 0x15),
        ('r22', 0x40, 0x16),
        ('r23', 0x40, 0x17),
        ('r24', 0x40, 0x18),
        ('r25', 0x40, 0x19),
        ('r26', 0x40, 0x1a),
        ('r27', 0x40, 0x1b),
        ('r28', 0x40, 0x1c),
        ('r29', 0x40, 0x1d),
        ('r30', 0x40, 0x1e),
        ('r31', 0x40, 0x1f),
        ('f0', 0x40, 0x20),
        ('f1', 0x40, 0x21),
        ('f2', 0x40, 0x22),
        ('f3', 0x40, 0x23),
        ('f4', 0x40, 0x24),
        ('f5', 0x40, 0x25),
        ('f6', 0x40, 0x26),
        ('f7', 0x40, 0x27),
        ('f8', 0x40, 0x28),
        ('f9', 0x40, 0x29),
        ('f10', 0x40, 0x2a),
        ('f11', 0x40, 0x2b),
        ('f12', 0x40, 0x2c),
        ('f13', 0x40, 0x2d),
        ('f14', 0x40, 0x2e),
        ('f15', 0x40, 0x2f),
        ('f16', 0x40, 0x30),
        ('f17', 0x40, 0x31),
        ('f18', 0x40, 0x32),
        ('f19', 0x40, 0x33),
        ('f20', 0x40, 0x34),
        ('f21', 0x40, 0x35),
        ('f22', 0x40, 0x36),
        ('f23', 0x40, 0x37),
        ('f24', 0x40, 0x38),
        ('f25', 0x40, 0x39),
        ('f26', 0x40, 0x3a),
        ('f27', 0x40, 0x3b),
        ('f28', 0x40, 0x3c),
        ('f29', 0x40, 0x3d),
        ('f30', 0x40, 0x3e),
        ('f31', 0x40, 0x3f),
        ('pc', 0x40, 0x40),
        ('msr', 0x40, 0x41),
        ('cr', 0x40, 0x42),
        ('lr', 0x40, 0x43),
        ('ctr', 0x40, 0x44),
        ('xer', 0x20, 0x45),
        ('fpscr', 0x20, 0x46),
        ('vr0', 0x80, 0x47),
        ('vr1', 0x80, 0x48),
        ('vr2', 0x80, 0x49),
        ('vr3', 0x80, 0x4a),
        ('vr4', 0x80, 0x4b),
        ('vr5', 0x80, 0x4c),
        ('vr6', 0x80, 0x4d),
        ('vr7', 0x80, 0x4e),
        ('vr8', 0x80, 0x4f),
        ('vr9', 0x80, 0x50),
        ('vr10', 0x80, 0x51),
        ('vr11', 0x80, 0x52),
        ('vr12', 0x80, 0x53),
        ('vr13', 0x80, 0x54),
        ('vr14', 0x80, 0x55),
        ('vr15', 0x80, 0x56),
        ('vr16', 0x80, 0x57),
        ('vr17', 0x80, 0x58),
        ('vr18', 0x80, 0x59),
        ('vr19', 0x80, 0x5a),
        ('vr20', 0x80, 0x5b),
        ('vr21', 0x80, 0x5c),
        ('vr22', 0x80, 0x5d),
        ('vr23', 0x80, 0x5e),
        ('vr24', 0x80, 0x5f),
        ('vr25', 0x80, 0x60),
        ('vr26', 0x80, 0x61),
        ('vr27', 0x80, 0x62),
        ('vr28', 0x80, 0x63),
        ('vr29', 0x80, 0x64),
        ('vr30', 0x80, 0x65),
        ('vr31', 0x80, 0x66),
        ('vscr', 0x20, 0x67),
        ('vrsave', 0x20, 0x68),
        ('vs0', 0x80, 0x69),
        ('vs1', 0x80, 0x6a),
        ('vs2', 0x80, 0x6b),
        ('vs3', 0x80, 0x6c),
        ('vs4', 0x80, 0x6d),
        ('vs5', 0x80, 0x6e),
        ('vs6', 0x80, 0x6f),
        ('vs7', 0x80, 0x70),
        ('vs8', 0x80, 0x71),
        ('vs9', 0x80, 0x72),
        ('vs10', 0x80, 0x73),
        ('vs11', 0x80, 0x74),
        ('vs12', 0x80, 0x75),
        ('vs13', 0x80, 0x76),
        ('vs14', 0x80, 0x77),
        ('vs15', 0x80, 0x78),
        ('vs16', 0x80, 0x79),
        ('vs17', 0x80, 0x7a),
        ('vs18', 0x80, 0x7b),
        ('vs19', 0x80, 0x7c),
        ('vs20', 0x80, 0x7d),
        ('vs21', 0x80, 0x7e),
        ('vs22', 0x80, 0x7f),
        ('vs23', 0x80, 0x80),
        ('vs24', 0x80, 0x81),
        ('vs25', 0x80, 0x82),
        ('vs26', 0x80, 0x83),
        ('vs27', 0x80, 0x84),
        ('vs28', 0x80, 0x85),
        ('vs29', 0x80, 0x86),
        ('vs30', 0x80, 0x87),
        ('vs31', 0x80, 0x88),
        ('vs32', 0x80, 0x89),
        ('vs33', 0x80, 0x8a),
        ('vs34', 0x80, 0x8b),
        ('vs35', 0x80, 0x8c),
        ('vs36', 0x80, 0x8d),
        ('vs37', 0x80, 0x8e),
        ('vs38', 0x80, 0x8f),
        ('vs39', 0x80, 0x90),
        ('vs40', 0x80, 0x91),
        ('vs41', 0x80, 0x92),
        ('vs42', 0x80, 0x93),
        ('vs43', 0x80, 0x94),
        ('vs44', 0x80, 0x95),
        ('vs45', 0x80, 0x96),
        ('vs46', 0x80, 0x97),
        ('vs47', 0x80, 0x98),
        ('vs48', 0x80, 0x99),
        ('vs49', 0x80, 0x9a),
        ('vs50', 0x80, 0x9b),
        ('vs51', 0x80, 0x9c),
        ('vs52', 0x80, 0x9d),
        ('vs53', 0x80, 0x9e),
        ('vs54', 0x80, 0x9f),
        ('vs55', 0x80, 0xa0),
        ('vs56', 0x80, 0xa1),
        ('vs57', 0x80, 0xa2),
        ('vs58', 0x80, 0xa3),
        ('vs59', 0x80, 0xa4),
        ('vs60', 0x80, 0xa5),
        ('vs61', 0x80, 0xa6),
        ('vs62', 0x80, 0xa7),
        ('vs63', 0x80, 0xa8),
        ('f32', 0x40, 0xa9),
        ('f33', 0x40, 0xaa),
        ('f34', 0x40, 0xab),
        ('f35', 0x40, 0xac),
        ('f36', 0x40, 0xad),
        ('f37', 0x40, 0xae),
        ('f38', 0x40, 0xaf),
        ('f39', 0x40, 0xb0),
        ('f40', 0x40, 0xb1),
        ('f41', 0x40, 0xb2),
        ('f42', 0x40, 0xb3),
        ('f43', 0x40, 0xb4),
        ('f44', 0x40, 0xb5),
        ('f45', 0x40, 0xb6),
        ('f46', 0x40, 0xb7),
        ('f47', 0x40, 0xb8),
        ('f48', 0x40, 0xb9),
        ('f49', 0x40, 0xba),
        ('f50', 0x40, 0xbb),
        ('f51', 0x40, 0xbc),
        ('f52', 0x40, 0xbd),
        ('f53', 0x40, 0xbe),
        ('f54', 0x40, 0xbf),
        ('f55', 0x40, 0xc0),
        ('f56', 0x40, 0xc1),
        ('f57', 0x40, 0xc2),
        ('f58', 0x40, 0xc3),
        ('f59', 0x40, 0xc4),
        ('f60', 0x40, 0xc5),
        ('f61', 0x40, 0xc6),
        ('f62', 0x40, 0xc7),
        ('f63', 0x40, 0xc8)
]


GDB_USER_X86_64_REG = [
        ('rax', 0x40, 0x0),
        ('rbx', 0x40, 0x1),
        ('rcx', 0x40, 0x2),
        ('rdx', 0x40, 0x3),
        ('rsi', 0x40, 0x4),
        ('rdi', 0x40, 0x5),
        ('rbp', 0x40, 0x6),
        ('rsp', 0x40, 0x7),
        ('r8', 0x40, 0x8),
        ('r9', 0x40, 0x9),
        ('r10', 0x40, 0xa),
        ('r11', 0x40, 0xb),
        ('r12', 0x40, 0xc),
        ('r13', 0x40, 0xd),
        ('r14', 0x40, 0xe),
        ('r15', 0x40, 0xf),
        ('rip', 0x40, 0x10),
        ('eflags', 0x20, 0x11),
        ('cs', 0x20, 0x12),
        ('ss', 0x20, 0x13),
        ('ds', 0x20, 0x14),
        ('es', 0x20, 0x15),
        ('fs', 0x20, 0x16),
        ('gs', 0x20, 0x17),
        ('st0', 0x50, 0x18),
        ('st1', 0x50, 0x19),
        ('st2', 0x50, 0x1a),
        ('st3', 0x50, 0x1b),
        ('st4', 0x50, 0x1c),
        ('st5', 0x50, 0x1d),
        ('st6', 0x50, 0x1e),
        ('st7', 0x50, 0x1f),
        ('fctrl', 0x20, 0x20),
        ('fstat', 0x20, 0x21),
        ('ftag', 0x20, 0x22),
        ('fiseg', 0x20, 0x23),
        ('fioff', 0x20, 0x24),
        ('foseg', 0x20, 0x25),
        ('fooff', 0x20, 0x26),
        ('fop', 0x20, 0x27),
        ('ymm0', 0x80, 0x28),
        ('ymm1', 0x80, 0x29),
        ('ymm2', 0x80, 0x2a),
        ('ymm3', 0x80, 0x2b),
        ('ymm4', 0x80, 0x2c),
        ('ymm5', 0x80, 0x2d),
        ('ymm6', 0x80, 0x2e),
        ('ymm7', 0x80, 0x2f),
        ('ymm8', 0x80, 0x30),
        ('ymm9', 0x80, 0x31),
        ('ymm10', 0x80, 0x32),
        ('ymm11', 0x80, 0x33),
        ('ymm12', 0x80, 0x34),
        ('ymm13', 0x80, 0x35),
        ('ymm14', 0x80, 0x36),
        ('ymm15', 0x80, 0x37),
        ('mxcsr', 0x20, 0x38)]



QEMU_X86_64_REG = [
        ('rax', 0x40, 0x0),
        ('rbx', 0x40, 0x1),
        ('rcx', 0x40, 0x2),
        ('rdx', 0x40, 0x3),
        ('rsi', 0x40, 0x4),
        ('rdi', 0x40, 0x5),
        ('rbp', 0x40, 0x6),
        ('rsp', 0x40, 0x7),
        ('r8', 0x40, 0x8),
        ('r9', 0x40, 0x9),
        ('r10', 0x40, 0xa),
        ('r11', 0x40, 0xb),
        ('r12', 0x40, 0xc),
        ('r13', 0x40, 0xd),
        ('r14', 0x40, 0xe),
        ('r15', 0x40, 0xf),
        ('rip', 0x40, 0x10),
        ('eflags', 0x20, 0x11),
        ('cs', 0x20, 0x12),
        ('ss', 0x20, 0x13),
        ('ds', 0x20, 0x14),
        ('es', 0x20, 0x15),
        ('fs', 0x20, 0x16),
        ('gs', 0x20, 0x17),
        ('fs_base', 0x40, 0x18),
        ('gs_base', 0x40, 0x19),
        ('k_gs_base', 0x40, 0x1a),
        ('cr0', 0x40, 0x1b),
        ('cr2', 0x40, 0x1c),
        ('cr3', 0x40, 0x1d),
        ('cr4', 0x40, 0x1e),
        ('cr8', 0x40, 0x1f),
        ('efer', 0x40, 0x20),
        ('st0', 0x50, 0x21),
        ('st1', 0x50, 0x22),
        ('st2', 0x50, 0x23),
        ('st3', 0x50, 0x24),
        ('st4', 0x50, 0x25),
        ('st5', 0x50, 0x26),
        ('st6', 0x50, 0x27),
        ('st7', 0x50, 0x28),
        ('fctrl', 0x20, 0x29),
        ('fstat', 0x20, 0x2a),
        ('ftag', 0x20, 0x2b),
        ('fiseg', 0x20, 0x2c),
        ('fioff', 0x20, 0x2d),
        ('foseg', 0x20, 0x2e),
        ('fooff', 0x20, 0x2f),
        ('fop', 0x20, 0x30),
        ('xmm0', 0x80, 0x31),
        ('xmm1', 0x80, 0x32),
        ('xmm2', 0x80, 0x33),
        ('xmm3', 0x80, 0x34),
        ('xmm4', 0x80, 0x35),
        ('xmm5', 0x80, 0x36),
        ('xmm6', 0x80, 0x37),
        ('xmm7', 0x80, 0x38),
        ('xmm8', 0x80, 0x39),
        ('xmm9', 0x80, 0x3a),
        ('xmm10', 0x80, 0x3b),
        ('xmm11', 0x80, 0x3c),
        ('xmm12', 0x80, 0x3d),
        ('xmm13', 0x80, 0x3e),
        ('xmm14', 0x80, 0x3f),
        ('xmm15', 0x80, 0x40),
        ('mxcsr', 0x20, 0x41)]


